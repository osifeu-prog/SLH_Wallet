<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SLH Wallet - × ×™×”×•×œ ××¨× ×§</title>
    <link rel="stylesheet" href="/static/css/style.css">
    <style>
        .form-group { margin-bottom: 1rem; }
        label { display: block; margin-bottom: 0.5rem; font-weight: bold; }
        input, select { width: 100%; padding: 0.5rem; border: 1px solid #ddd; border-radius: 4px; }
        button { background: #007bff; color: white; padding: 0.75rem 1.5rem; border: none; border-radius: 4px; cursor: pointer; }
        button:hover { background: #0056b3; }
        .section { margin-bottom: 2rem; padding: 1rem; border: 1px solid #eee; border-radius: 8px; }
        .metamask-btn { background: #f6851b; margin-left: 1rem; }
        .bank-section { background: #f8f9fa; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ§³ ×”×’×“×¨×ª ××¨× ×§ SLH / BNB</h1>
        <p>×˜×•×¤×¡ ×–×” ××—×‘×¨ ×‘×™×Ÿ ××©×ª××© ×”×˜×œ×’×¨× ×©×œ×š ×œ×‘×™×Ÿ ×›×ª×•×‘×•×ª ×”××¨× ×§ ×•×¤×¨×˜×™ ×”×‘× ×§.</p>
        
        <div id="message" style="display: none;"></div>

        <form id="walletForm">
            <div class="section">
                <h2>ğŸ“± ×¤×¨×˜×™ ×˜×œ×’×¨×</h2>
                <div class="form-group">
                    <label for="telegram_id">Telegram ID *</label>
                    <input type="text" id="telegram_id" name="telegram_id" required>
                </div>
                <div class="form-group">
                    <label for="username">×©× ××©×ª××© ×‘×˜×œ×’×¨× (username)</label>
                    <input type="text" id="username" name="username">
                </div>
                <div class="form-group">
                    <label for="first_name">×©× ×¤×¨×˜×™</label>
                    <input type="text" id="first_name" name="first_name">
                </div>
                <div class="form-group">
                    <label for="last_name">×©× ××©×¤×—×”</label>
                    <input type="text" id="last_name" name="last_name">
                </div>
            </div>

            <div class="section">
                <h2>ğŸ’° ×›×ª×•×‘×•×ª ××¨× ×§</h2>
                <button type="button" id="connectMetamask" class="metamask-btn">ğŸ”— ×—×‘×¨ MetaMask</button>
                
                <div class="form-group">
                    <label for="bnb_address">BNB Address (BEP20)</label>
                    <input type="text" id="bnb_address" name="bnb_address" placeholder="0x...">
                </div>
                <div class="form-group">
                    <label for="slh_address">SLH Address (×× ×©×•× ×”)</label>
                    <input type="text" id="slh_address" name="slh_address" placeholder="0x...">
                </div>
            </div>

            <div class="section bank-section">
                <h2>ğŸ¦ ×¤×¨×˜×™ ×‘× ×§ ×œ×”×¢×‘×¨×•×ª</h2>
                <div class="form-group">
                    <label for="bank_name">×©× ×”×‘× ×§</label>
                    <input type="text" id="bank_name" name="bank_name">
                </div>
                <div class="form-group">
                    <label for="bank_branch">×¡× ×™×£</label>
                    <input type="text" id="bank_branch" name="bank_branch">
                </div>
                <div class="form-group">
                    <label for="bank_account_number">××¡×¤×¨ ×—×©×‘×•×Ÿ</label>
                    <input type="text" id="bank_account_number" name="bank_account_number">
                </div>
            </div>

            <button type="submit">ğŸ’¾ ×©××™×¨×ª ××¨× ×§</button>
        </form>

        <div class="section" style="margin-top: 2rem;">
            <h2>ğŸ“¤ ×”×¢×œ××ª ××™×©×•×¨ ×”×¢×‘×¨×”</h2>
            <form id="transferProofForm">
                <div class="form-group">
                    <label for="proof_telegram_id">Telegram ID *</label>
                    <input type="text" id="proof_telegram_id" name="telegram_id" required>
                </div>
                <div class="form-group">
                    <label for="proof_description">×ª×™××•×¨ ×”×”×¢×‘×¨×”</label>
                    <input type="text" id="proof_description" name="description" placeholder="×œ××©×œ: ×”×¢×‘×¨×” ×¢×‘×•×¨ ×¨×›×™×©×ª SLH">
                </div>
                <div class="form-group">
                    <label for="proof_file">×§×•×‘×¥ ××™×©×•×¨ ×”×¢×‘×¨×” *</label>
                    <input type="file" id="proof_file" name="file" accept="image/*,.pdf" required>
                </div>
                <button type="submit">ğŸ“ ×”×¢×œ××” ×œ××™×©×•×¨</button>
            </form>
        </div>
    </div>

    <script>
        // âœ… ××™× ×˜×’×¨×¦×™×” ×¢× MetaMask
        document.getElementById('connectMetamask').addEventListener('click', async function() {
            if (typeof window.ethereum !== 'undefined') {
                try {
                    const accounts = await window.ethereum.request({ 
                        method: 'eth_requestAccounts' 
                    });
                    
                    if (accounts.length > 0) {
                        const account = accounts[0];
                        document.getElementById('bnb_address').value = account;
                        document.getElementById('slh_address').value = account;
                        showMessage('âœ… MetaMask ××—×•×‘×¨ ×‘×”×¦×œ×—×”! ×”×›×ª×•×‘×ª ××•×œ××” ××•×˜×•××˜×™×ª.', 'success');
                    }
                } catch (error) {
                    showMessage('âŒ ××©×ª××© ×“×—×” ××ª ×”×‘×§×©×” ×œ×—×™×‘×•×¨ MetaMask', 'error');
                }
            } else {
                showMessage('âŒ MetaMask ×œ× ××•×ª×§×Ÿ ×‘×“×¤×“×¤×Ÿ ×©×œ×š', 'error');
            }
        });

        // âœ… ×©×œ×™×—×ª ×˜×•×¤×¡ ×”××¨× ×§
        document.getElementById('walletForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const formData = new FormData(this);
            const data = Object.fromEntries(formData.entries());
            
            try {
                const response = await fetch('/api/wallet/register', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                
                if (response.ok) {
                    showMessage('âœ… ×”××¨× ×§ × ×©××¨ ×‘×”×¦×œ×—×”!', 'success');
                } else {
                    const error = await response.json();
                    showMessage('âŒ ×©×’×™××” ×‘×©××™×¨×ª ×”××¨× ×§: ' + error.detail, 'error');
                }
            } catch (error) {
                showMessage('âŒ ×©×’×™××ª ×¨×©×ª: ' + error.message, 'error');
            }
        });

        // âœ… ×©×œ×™×—×ª ×˜×•×¤×¡ ××™×©×•×¨ ×”×¢×‘×¨×”
        document.getElementById('transferProofForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const formData = new FormData(this);
            
            try {
                const response = await fetch('/api/wallet/upload-transfer-proof', {
                    method: 'POST',
                    body: formData
                });
                
                if (response.ok) {
                    showMessage('âœ… ×”×§×•×‘×¥ ×”×•×¢×œ×” ×‘×”×¦×œ×—×” ×•×××ª×™×Ÿ ×œ××™×©×•×¨!', 'success');
                    this.reset();
                } else {
                    const error = await response.json();
                    showMessage('âŒ ×©×’×™××” ×‘×”×¢×œ××ª ×”×§×•×‘×¥: ' + error.detail, 'error');
                }
            } catch (error) {
                showMessage('âŒ ×©×’×™××ª ×¨×©×ª: ' + error.message, 'error');
            }
        });

        function showMessage(text, type) {
            const messageDiv = document.getElementById('message');
            messageDiv.textContent = text;
            messageDiv.style.display = 'block';
            messageDiv.style.color = type === 'success' ? 'green' : 'red';
            messageDiv.style.padding = '1rem';
            messageDiv.style.margin = '1rem 0';
            messageDiv.style.borderRadius = '4px';
            messageDiv.style.backgroundColor = type === 'success' ? '#f0fff0' : '#fff0f0';
            
            setTimeout(() => {
                messageDiv.style.display = 'none';
            }, 5000);
        }

        // âœ… ××™×œ×•×™ ××•×˜×•××˜×™ ×©×œ ×¤×¨×˜×™× ×-URL parameters
        function fillFromUrlParams() {
            const urlParams = new URLSearchParams(window.location.search);
            document.getElementById('telegram_id').value = urlParams.get('telegram_id') || '';
            document.getElementById('username').value = urlParams.get('username') || '';
            document.getElementById('first_name').value = urlParams.get('first_name') || '';
            document.getElementById('proof_telegram_id').value = urlParams.get('telegram_id') || '';
        }

        fillFromUrlParams();
    </script>
</body>
</html>
